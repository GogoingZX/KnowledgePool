---
title: "ST5210-Tut4"
author: "Name:Zhu Xu; User ID:E0337988; Student ID:A0191344H"
date: "18 Spetember 2018"
output:
  html_document:
    df_print: paged
  pdf_document: 
    latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Question 1

### (a) Using the following code to download the Dow Jones Index starting from 2000-01-01
```{r}
library(tseries)
dji <- get.hist.quote(instrument = "^DJI", start="2000-01-01",
                     quote = c("AdjClose"),provider = "yahoo", compression = "d")

# (b) calculate the log-return
returns <- diff(log(dji), lag = 1, differences = 1)   # 一阶差分 first order difference
# lag 控制差分的间隔， differences控制差分的次数，按照lag间隔进行差分


# (c) To find the returns on ’Tuesday’
Tuesday <- (weekdays(time(returns))== "星期二" )
# returns 的类型是 “zoo”， zoo的类型是data， return包含：第一列是时间"2003-12-24"，第二列是数据

# (d) test whether the returns on Tuesday and that on one of the other days have statistical difference.
Tuesday_adjclose <- returns[Tuesday]    # 964 numbers
Monday <- ( weekdays(time(returns)) == "星期一" )
Wednesday <- ( weekdays(time(returns)) == "星期三" )
Thursday <- ( weekdays(time(returns)) == "星期四" )
Friday <- ( weekdays(time(returns)) == "星期五" )

Monday_adjclose <- returns[Monday]
Wednesday_adjclose <- returns[Wednesday]
Thursday_adjclose <- returns[Thursday]
Friday_adjclose <- returns[Friday]

# 以周二和周一为例
t.test(Tuesday_adjclose, Monday_adjclose)

```
###The result shows that returns on Tuesday and Monday do not have statistical difference

```{r}
# (e) We may also use ’paired’ test, i.e. compar the returns in the same week, to check whether
# Tuesday is different statistically from the others.]

name <- c("星期一", "星期二", "星期三", "星期四", "星期五")
completed_period <- function(name, x){
  # name 是完整的周期， x是有残缺值的时间序列
  # install.packages("miscTools")
  library(miscTools)
  
  x<-returns
  
  t <- weekdays(time(x))
  x_df <- as.matrix(x)  #为了在x中添加缺失列，不知道怎样在时间序列zoo中添加
  
  len_period <- length(name)
  
  # 为了使得count1是按照周期序号变化
  return_count1 <- function(count1, len_period){
    count1 <- count1 + 1
    if(count1 == len_period+1){count1 <- 1}
    return(count1)
  }
  
  count <- 1
  count1 <- 1
  count2 <- 1  # to t
  while(1){
    
    if( t[count2] == name[count1] ){
      count <- count + 1
      count1 <- return_count1(count1, len_period)
      count2 <- count2 + 1
      if(count2 > length(t)){break}
    }
    if( t[count2] != name[count1] ){
      add <- as.matrix( rep("cc", ncol(x_df)) )
      x_df <- insertRow(x_df, count, add)
      count <- count + 1
      count1 <- return_count1(count1, len_period)
    }
    
  }
  
  return(x_df)
}
x_df <- completed_period(name, returns)

len_period <- length(name)
# x_df_reshap每e行为周一到周五的数据， 空缺的数据用“cc”代替
x_df_reshape <- matrix(x_df[-nrow(x_df),], (nrow(x_df)-1)/len_period, len_period, byrow = T)

# 下面的代码是为了删除x_df_reshape中含有空缺数据的行，使得每一周5天的数据都是完整的
TT <- x_df_reshape; j <- 1; saveindex <- numeric()
for(i in 1:nrow(TT)){
  len1 <- length(which(TT[i,] == "cc"))
  if(len1 != 0){saveindex[j] <- i; j <- j+1} 
}
rm(TT, i, j)
completed_weeks <- x_df_reshape[-saveindex,]
completed_weeks <- as.numeric(t(completed_weeks))
len <- length(completed_weeks)
completed_weeks <- matrix(completed_weeks, len/5, 5, byrow = T)

# 配对检验, for example, Tuesday and Monday
t.test(completed_weeks[,2], completed_weeks[,1], paired = T)
```
###Tuesday is not different statistically from other days.

#Question 2

```{r}
rm(list = ls())
Data <- read.csv("C:/Users/MSI/Desktop/Notes/ST5210-Multivariate Data Analysis/Tutorial/Tutorial04/dailyReturn.csv", header = T)
portfolios <- Data[,-1]
colnum <- ncol(portfolios)
test.data <- portfolios[,c(2:colnum)] - portfolios[,c(1:colnum-1)]
# install.packages("ICSNP")
library(mvtnorm)
library(ICS)
library(ICSNP)
HotellingsT2(test.data)
```

###30 portfolios have no significant difference in term of the long-run mean.

\usepackage{amsmath}

#Question 3:

###a)

\begin{align*}
&\qquad Var(\bar{X})=E(\bar{X})^2-[E(\bar{X})]^2\\
&\Rightarrow \frac{1}{n^2}Var(\sum_{i=1}^{n}X_i)=[E(\bar{X})]^2-[\frac{1}{n}E(\sum_{i=1}^{n}X_i)]^2\\
&\Rightarrow \frac{\sum_x}{n}=E(\bar{X})^2-\mu_{X}^{2}\\
&\Rightarrow E(\bar{X})^2=\frac{\sum_x}{n}+\mu_{X}^{2}\\
&\Rightarrow E(\bar{Y})^2=\frac{\sum_y}{n}+\mu_{Y}^{2}\\
\end{align*}

\begin{align*}
\qquad E[(\bar{X}-\bar{Y})^2]&=E[\bar{X}^2+\bar{Y}^2-2\bar{X}\bar{Y}]\\
&=E(\bar{X}^2)+E(\bar{Y}^2)-2EE(\bar{X}\bar{Y})\\
&=\frac{\sum_x}{n}+\mu_{X}^2+\frac{\sum_y}{n}+\mu_y^2-2\mu_X\mu_Y\\
[E(\bar{X}-\bar{Y})]^2&=[E(\bar{X}-E(\bar{Y})]^2\\
&=\mu_{x}^2+\mu_{y}^2-2\mu_{x}\mu_{Y}\\
Var(\bar{X}-\bar{Y})&=E[(\bar{X}-\bar{Y})^2]-[E(\bar{X}-\bar{Y})]^2\\
&=\frac{\sum_x}{n}+\mu_{X}^2+\frac{\sum_y}{n}+\mu_y^2-2\mu_X\mu_Y-\mu_{x}^2-\mu_{y}^2+2\mu_{x}\mu_{Y}\\
&=\frac{\sum_x}{n}+\frac{\sum_y}{n}
\end{align*}

###b)

\begin{align*}
Var(\bar{X})&=\frac{\sum_x}{n};\qquad Var(\bar{Y})=\frac{\sum_y}{n}\\
2cov(\bar{X},\bar{Y})&=2cov(\frac{\sum_{i=1}^{n}X}{n},\frac{\sum_{i=1}^{n}Y}{n})\\
&=\frac{2}{n^2}cov(X_1+\cdots +X_n,Y_1+\cdots +Y_n)\\
&=\frac{2}{n^2}[cov(X_1,Y_1)+\cdots +cov(X_n,Y_n)]\\
&=\frac{2n\sum_{XY}}{n^2}\\
&=\frac{2\sum_{XY}}{n}
\end{align*}

#Question 4:

$\qquad D\sim N(A\mu,A\sum A^{T})$
$$
A=
\begin{bmatrix}
1&-1&0\\
0&1&-1\\
\end{bmatrix}
$$

$$
A_\mu=\begin{bmatrix}
1&-1&0\\
0&1&-1\end{bmatrix}
\begin{bmatrix}
\mu_1\\
\mu_2\\
\mu_3\end{bmatrix}
=\begin{bmatrix}
\mu_1-\mu_2\\
\mu_2-\mu_3\end{bmatrix}
$$


$$
\begin{align*}
A\sum A^{T}&=\begin{bmatrix}
1&-1&0\\
0&1&-1\end{bmatrix}
\begin{bmatrix}
\sigma_{11}&\sigma_{12}&\sigma_{13}\\
\sigma_{21}&\sigma_{22}&\sigma_{23}\\
\sigma_{31}&\sigma_{32}&\sigma_{33}\end{bmatrix}
\begin{bmatrix}
1&0\\
-1&1\\
0&-1\end{bmatrix}\\
&=\begin{bmatrix}
\sigma_{11}-\sigma_{21}&\sigma_{12}-\sigma_{22}&\sigma_{13}-\sigma_{23}\\
\sigma_{21}-\sigma_{31}&\sigma_{22}-\sigma_{32}&\sigma_{23}-\sigma_{33}\end{bmatrix}
\begin{bmatrix}
1&0\\
-1&1\\
0&-1\end{bmatrix}\\
&=\begin{bmatrix}
\sigma_{11}-\sigma_{21}-\sigma_{12}+\sigma_{22}&\sigma_{12}-\sigma_{22}-\sigma_{13}+\sigma_{23}\\
\sigma_{21}-\sigma_{31}-\sigma_{22}+\sigma_{32}&\sigma_{22}-\sigma_{32}-\sigma_{23}+\sigma_{33}\end{bmatrix}\\
&=\begin{bmatrix}
\sigma_{11}-2\sigma_{21}+\sigma_{22}&\sigma_{12}-\sigma_{22}-\sigma_{13}+\sigma_{23}\\
\sigma_{21}-\sigma_{31}-\sigma_{22}+\sigma_{32}&\sigma_{22}-2\sigma_{32}+\sigma_{33}\end{bmatrix}
\end{align*}
$$



