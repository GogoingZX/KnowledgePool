---
title: "ST5218_Tut5"
author:
- Name:Zhu Xu
- User ID:E0337988
- Matriculation ID:A0191344H
date: "20/Mar/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\rule[-5pt]{16.3cm}{0.15em}
\linespread{1.3}

###Question 3:

$$
E(I_1 I_2)=P(I_1=1,I_2=1)=P(Y_1\leq F^{-1}(u_1),Y_2\leq F^{-1}(u_2))=C(u_1,u_2)
$$

###Quetion 4:

$$
C(u_1,u_2;\rho)=\int_{-\infty}^{\Phi^{-1}(u_1)}\int_{-\infty}^{\Phi^{-1}(u_2)}\frac{1}{2\pi\sqrt{(1-\rho^2)}}exp\{-\frac{s_1^2-2\rho s_1s_2+s_2^2}{2(1-\rho^2)}\}ds_1s_2
$$

where $\Phi^{-1}(\cdot)$ is the quantile or inverse function of standard normal.

$$
\Phi_1(x)=\Phi(\frac{x-\mu_1}{\sigma_1}),\quad \Phi_2(x)=\Phi(\frac{x-\mu_2}{\sigma_2})
$$

The combined joint distribution is
\begin{equation*}
\begin{split}
C((\Phi_1(x_1),\Phi_2(x_2),\rho)&=\int_{-\infty}^{\Phi^{-1}(x_1)}\int_{-\infty}^{\Phi^{-1}(x_2)}\frac{1}{2\pi\sqrt{(1-\rho^2)}}exp\{-\frac{s_1^2-2\rho s_1s_2+s_2^2}{2(1-\rho^2)}\}ds_1s_2\\
&=\int_{-\infty}^{\frac{x_1-\mu_1}{\sigma_1}}\int_{-\infty}^{\frac{x_2-\mu_2}{\sigma_2}}\frac{1}{2\pi\sqrt{(1-\rho^2)}}exp\{-\frac{s_1^2-2\rho s_1s_2+s_2^2}{2(1-\rho^2)}\}ds_1s_2\\
&=\int_{-\infty}^{x_1}\int_{-\infty}^{x_2}\frac{1}{2\sigma_1\sigma_2\pi\sqrt{(1-\rho^2)}}exp\{-\frac{\frac{(t_1-\mu_1)^2}{\sigma_1^2}+\frac{(t_2-\mu_2)^2}{\sigma_2^2}-2\rho\frac{(s_1-\mu_1)(s_2-\mu_2)}{\sigma-1\sigma_2}}{2(1-\rho^2)}\}dt_1t_2
\end{split}
\end{equation*}
where $t_1=s_1\sigma_1+\mu_1\quad t_2=s_2\sigma_2+\mu_2$

\newpage
###Question 5:

Because

$$
P(X'<x')=P(X<x'-1)
$$

Then let it be $u$

$$
F^{-1}_X(u)=F^{-1}_{X'}(u)-1
$$

Similarly

$$
P(Y'<y')=P(-Y<y'-1)=P(Y>-y'+1)=1-P(Y\leq-y'+1)
$$

Then let it be $v$

$$
F^{-1}_Y(1-v)=1-F^{-1}_{Y'}(v)
$$

Finally

\begin{equation*}
\begin{split}
C_{X',Y'}(u,v)&=P(X'<F^{-1}_{X'}(u),Y'<F^{-1}_{Y'}(v))\\
&=P(X+1<F^{-1}_{X'}(u),-Y+1<F^{-1}_{Y'}(v))\\
&=P(X+1<F^{-1}_{X}(u)+1,Y>1-F^{-1}_{Y'}(v))\\
&=P(X<F^{-1}_{X}(u),Y>F^{-1}_{Y}(1-v))\\
&=P(X<F^{-1}_{X}(u))-P(X<F_X^{-1}(u),Y<F^{-1}_{Y}(1-v))\\
&=u-P(X<F_X^{-1}(u),Y<F^{-1}_{Y}(1-v))\\
&=u-C_{X,Y}(u,1-v)\\
\end{split}
\end{equation*}

###Question 6:

The CDF of $(X_1,X_2)$ is

$$
F(x_1,x_2)=C(F_1(x_1),F_2(x_2))
$$

Then

$$
F(y_1,y_2)=C(F_1(\frac{y_1-b}{a}),F_2(\frac{y_2-d}{c}))
$$

Thus the density is

\begin{equation*}
\begin{split}
f(y_1,y_2)&=c(F_1(\frac{y_1-b}{a}),F_2(\frac{y_2-d}{c}))\frac{d}{dy_1}F_1(\frac{y_1-b}{a})\frac{d}{dy_2}F_2(\frac{y_2-d}{c})\\
&=c(F_1(\frac{y_1-b}{a}),F_2(\frac{y_2-d}{c}))\frac{1}{a}f_1(\frac{y_1-b}{a})\frac{1}{c}f_2(\frac{y_2-d}{c})
\end{split}
\end{equation*}

\newpage
###Question 7:

####a)

$$
f_{new}(y_1,y_2)\geq 0
$$
\begin{equation*}
\begin{split}
\int\int f_{new}(y_1,y_2)dy_1dy_2&=\int\int c_{new}(F_1{y_1},F_2(y_2))f_1(y_1)f_2(y_2)dy_1dy_2\\
&=\int\int c_{new}(F_1{y_1},F_2(y_2))dF_1(y_1)dF_2(y_2)d\\
&=\int_0^1\int_0^1 c_{new}(u_1,u_2)du_1du_2\\
&=1
\end{split}
\end{equation*}
where $u_1=F_1(y_1),\quad u_2=F_2(y_2)$

####b)

Because $c_{new}(F_1(y_1))=1$

Thus
\begin{equation*}
\begin{split}
f_{new,1}(y_1)&=\int f_{new}(y_1,y_2)dy_2\\
&=\int c_{new}(F_1(y_1),F_2(y_2))f_1(y_1)f_2(y_2)dy_2\\
&=\int c_{new}(F_1(y_1),F_2(y_2))f_1(y_1)dF_2(y_2)\\
&=\int_0^1\int_0^1 c_{new}(F_1(y_1),u_2)f_1(y_1)du_2\\
&=c_{new}(F_1(y_1))f_1(y_1)\\
&=f_1(y_1)
\end{split}
\end{equation*}

###Question 8:

####a)
$L_\lambda =\lim\limits_{q\rightarrow 0}\frac{C(q,q)}{q}=\lim\limits_{q\rightarrow 0}q=0$

####b),c)
$1$, $\frac{1}{2}$

####d)

$\lambda_L=\lim\limits_{q\rightarrow 0^+}\frac{(q^{-\theta}+q^{-\theta}-1)^{-\theta^{-1}}}{q}=\lim\limits_{q\rightarrow 0^+}\frac{(\frac{q^\theta}{2-q^\theta})^{\theta^{-1}}}{q}=\lim\limits_{q\rightarrow 0^+}\frac{1}{(2-q^\theta)^{\theta^{-1}}}=\frac{1}{2^{\theta^{-1}}}=2^{-\theta^{-1}}$

\newpage
###Quetion 9:

Because

$$
F(x_1,x_2)=C(\Phi(x_1),\Phi(x_2))=\frac{\Phi(x_1)\Phi(x_2)}{\Phi(x_1)+\Phi(x_2)-\Phi(x_1)\Phi(x_2)}
$$

$$
\frac{\partial}{\partial u_1}C(u_1,u_2)=\frac{u_2(u_1+u_2-u_1u_2)-u_1u_2(1-u_2)}{(u_1+u_2-u_1u_2)^2}=\frac{u_2^2}{(u_1+u_2-u_1u_2)^2}
$$

$$
c(u_1,u_2)=\frac{\partial^2}{\partial u_1\partial u_2}C(u_1,u_2)=\frac{\partial}{\partial}\frac{u_2^2}{(u_1+u_2-u_1u_2)^2}=\frac{2u_1u_2}{(u_1+u_2-u_1u_2)^3}
$$

Thus

$$
f(x_1,x_2)=c(\Phi(x_1),\Phi(x_2))\phi(x_1)\phi(x_2)=\frac{2\Phi(x_1)\Phi(x_2)}{(\Phi(x_1)+\Phi(x_2)-\Phi(x_1)\Phi(x_2))^3}\phi(x_1)\phi(x_2)
$$

###Quetion 10:

####a)

To prove that $C_{new}(u_1,u_2,\cdots,u_p)$ is a copula, it satisfies $(u_1,u_2,\cdots,u_p)\in[0,1]^p$

$C_{new}(u_1,u_2,\cdots,u_p)$ is cumulative function $[0,1]^p$, because $C_1(u_1,u_2,\cdots,u_p),\quad C_2(u_1,u_2,\cdots,u_p)$ are copulas, they must satisfy the above property, and their summation also do.

Then $C_{new}(u_1,u_2,\cdots,u_p)$ has marginal CDFs that satisfy

\begin{equation*}
\begin{split}
C_k(u)&=C_{new}(1,\cdots,1,u,1,\cdots,1)\\
&=wC_1(1,\cdots,1,u,1,\cdots,1)+(1-w)C_2(1,\cdots,1,u,1,\cdots,1)\\
&=w*u+(1-w)*u\\
&=u
\end{split}
\end{equation*}
$\Rightarrow$ Marginal distributions are uniform $[0,1]$.

Since $\{x_1,x_2,\cdots,x_n\}=\{x_(1),x_(2),\cdots,x_(n)\}$ and each rank will take some integer value from 1 to n

$$
\frac{1}{n+1}\sum_{i=1}^n(x_i\leq x_{(j)})=\frac{j}{n+1}
$$

Thus $\{U_1,\cdots ,U_n\}=\{\frac{j}{n+1};j=1,\cdots,n\}$

\newpage
###Quetion 11:

####a)

```{r, message=FALSE, warning=FALSE}
library(tseries)
library(timeSeries)
library(fCopulae)
library(MASS)

MMM = get.hist.quote(instrument="MMM",
                     start="2008-01-01", end="2009-12-31",
                     quote=c("AdjClose"), provider="yahoo",
                     compression="d")
MSFT = get.hist.quote(instrument="MSFT",
                     start="2008-01-01", end="2009-12-31",
                     quote=c("AdjClose"), provider="yahoo",
                     compression="d")

r.MMM = as.data.frame(diff(log(MMM)))
r.MSFT = as.data.frame(diff(log(MSFT)))

FitT.MMM = fitdistr(r.MMM[,1], "t")
FitT.MSFT = fitdistr(r.MSFT[,1], "t")

FitT.MMM
FitT.MSFT
```

####b)

```{r message=FALSE, warning=FALSE}
library(copula)
n = nrow(r.MMM)
U.MMM = rank(r.MMM)/(n+1)
U.MSFT = rank(r.MSFT)/(n+1)

data = data.frame(list(U.MMM=U.MMM, U.MSFT=U.MSFT)) 
data = data.matrix(data)

tCopula = tCopula(dim=2)
FIT1 = fitCopula(tCopula, data)
FIT1
```

###Question 12:

```{r}
library(copula)
c1 = normalCopula(param=0.8) 
c2 = tCopula(param=0.8)
c3 = claytonCopula(param = 0.8) 
c4 = frankCopula(param= 0.8) 
c5 = gumbelCopula(param= 1.6) 

q = 0.000001
pCopula(c(q,q), c1)/q 
pCopula(c(q,q), c2)/q 
pCopula(c(q,q), c3)/q 
pCopula(c(q,q), c4)/q 
pCopula(c(q,q), c5)/q
```


