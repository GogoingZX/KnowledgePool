---
title: "ST5218_Tut_3"
author:
- Zhu Xu
- User ID:E0337988
- Matriculation ID:A0191344H
date: "13/Feb/2019"
output: pdf_document
---
\rule[-5pt]{16.3cm}{0.15em}
\linespread{1.3}
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Q1:

```{r message=FALSE, warning=FALSE}
library(tseries)
library(moments)
library(MASS)
SP500 = get.hist.quote(instrument = "^gspc",
                       start="2014-01-01", end="2016-12-31",
                       quote=c("AdjClose"), provider="yahoo",
                       compress="d")
daily.log.return = diff(log(SP500), lag=1)
fit.t = fitdistr(daily.log.return, "t")
```

####a)

```{r}
fit.t
```

\newpage
####b)

```{r}
m = fit.t$estimate[1]
s = fit.t$estimate[2]
df = fit.t$estimate[3]
n = length(daily.log.return)
qqplot(qt(ppoints(n), df), (as.numeric(daily.log.return)-m)/s)
lines(qt(ppoints(n), df), qt(ppoints(n), df))
# The distribution does not fit well for the data in the tails
```

####c)

$Y=\frac{r-0.0005095120}{0.0062012019}\sim t(3.8465161900)$

With probability 0.001.

$VaR_{0.001}(R)=7.471026$

$VaR_{0.001}(R)=7.471026*0.0062012019-0.0005095120=0.04581983$

\newpage
###Q2:

$$
\mu=
\left(
\begin{matrix}
\mu_1\\
\mu_2\\
\end{matrix}
\right)
$$

$$
\sum=
\left(
\begin{matrix}
\sigma_1^2 &\rho\sigma_1\sigma_2\\
\rho\sigma_1\sigma_2 &\sigma_2^2\\
\end{matrix}
\right)
$$

$$
f_x(x,y)=\frac{\Gamma[(\nu+2/2)]}{\Gamma(\nu/2)(\nu\pi)}(\sigma_1^2\sigma_2^2(1-\rho)^2)^{-\frac{1}{2}}[1+\frac{1}{\nu(1-\rho)^2}(\frac{(x-\mu_x^2)}{\sigma_x^2}+\frac{(y-\mu_y^2)}{\sigma_y^2}-\frac{2\rho(x-\mu_x)(y-\mu_y)}{\sigma_x\sigma_y})]^{\frac{-(\nu+2)}{2}}
$$

###Q3:

####a)

\begin{center}
$E(Y)=(0.2, 0.3, 0.2)^T$
\end{center}

$$
Cov(Y)=
\left(
\begin{matrix}
0.8^2+1 &0.8*0.7 &0.8*0.9\\
0.7*0.8 &0.7^2+1 &0.7*0.9\\
0.9*0.8 &0.9*0.7 &0.9^2+1\\
\end{matrix}
\right)
$$

####b)

All the covariances are positive, because all that $Y_i$ depend on common factor $X$ with positive coefficients.

###Q4:

####a)

```{r}
MMMdata = get.hist.quote(instrument="MMM", 
                         start="2014-01-01", end="2014-12-31",
                         quote=("AdjClose"), provider="yahoo",
                         compression="d")
MSFTdata = get.hist.quote(instrument="MSFT", 
                         start="2014-01-01", end="2014-12-31",
                         quote=("AdjClose"), provider="yahoo",
                         compression="d")
AAPLdata = get.hist.quote(instrument="AAPL", 
                         start="2014-01-01", end="2014-12-31",
                         quote=("AdjClose"), provider="yahoo",
                         compression="d")
x = merge(MMMdata, MSFTdata, AAPLdata)
R = diff(log(x))
colnames(R)[1] = "MMM"
colnames(R)[2] = "MSFT"
colnames(R)[3] = "AAPL"
pairs(R)
cor(R)
```

\newpage
####b)

```{r}
n = length(MMMdata)
abs(cor(R)[1,2]) > qnorm(1-0.01/2)/sqrt(n-3)
abs(cor(R)[1,3]) > qnorm(1-0.01/2)/sqrt(n-3)
abs(cor(R)[2,3]) > qnorm(1-0.01/2)/sqrt(n-3)
```

###Q5:

$$
Var(wR_1+(1-w)R_2)=w^2\sigma_1^2+2w(1-w)\sigma_{12}+(1-w^2)\sigma_2^2
$$
The first order condition is:
$$
2w\sigma_1^2+2(1-2w)\sigma_{12}+2(w-1)\sigma_2^2=0
$$
The solution:
$$
w=\frac{\sigma_2^2-\sigma_{12}}{\sigma_1^2+\sigma_2^2-2\sigma_{12}}
$$

###Q6:

Finding $w_1\cdots w_n$ to minimize $Var(\sum_{i=1}^nw_kR_k)$ with $w_1+\cdots +w_n=1$

Using Lagrange multipliers:
$$
\mathop{min}_{w_1,\cdots, w_n,\lambda}\{Var(\mathop{\sum}_{i=1}^n w_kR_k)+\lambda(w_1+\cdots+w_n -1)\}
$$
Taking derivatives respect to $w_k$ and $\lambda$:
$$
2w_k\sigma_k^2+\lambda=0,\qquad k=1,\cdots,n
$$
The solution is:
$$
w_k=-\frac{\lambda}{2\sigma^2},\quad \lambda=-\frac{2}{(\frac{1}{\sigma_1^2})+\cdots+(\frac{1}{\sigma_n^2})}
$$

$$
\Rightarrow\quad w_k=\frac{1/ \sigma_k}{1/ \sigma_1^2+\cdots+1/ \sigma_1^2}
$$

\newpage
###Q7:

####a)

Let $w_1, w_2$ be the weighting corresponding to A and B
\begin{center}
$w_1+w_2=1$

$E(R_N)=w_1E(R_1)+w_2E(R_2)=w_1r_1+w_2r_2$

$2.3\%w_1+4.5\%w_2=3\%\quad\Rightarrow w_1=0.682,\quad w_2=0.318$
\end{center}

Thus $R_N=0.682R_1+0.318R_2$

####b)

\begin{center}
$\sigma_N^2=w_1^2\sigma_1^2+w_2^2\sigma_2^2+2\rho_{12} w_1w_2\sigma_1\sigma_2$

$5.5\%=6\%w_1^2+11\%w_2^2+2*0.17*6\%*11\%w_1w_2$

$w_1+w_2=1$

$w_1=0.9404,\quad w_2=0.0596,\quad r_N=2.43\%$

or

$w_1=0.411,\quad w_2=0.589,\quad r_N=3.60\%$
\end{center}

So the largest expected return is:
$$R_N=0.411R_1+0.589R_2$$





